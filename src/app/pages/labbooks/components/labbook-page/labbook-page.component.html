<ng-container>
  <ng-container *transloco="let t">
    <div [class.with-sidebar]="showSidebar">
      <aside *ngIf="showSidebar">

      </aside>
      <main style="padding: 0 1%  1% 1%">

        <div style="text-align: center; display: flex; flex-wrap: nowrap; justify-content: center;
        align-items: center;white-space: nowrap;overflow: visible;">
          <strong>{{detailsTitle}}</strong>
          <mlzeln-details-dropdown
                  [is_labbook]='true'
                  [service]="labBooksService"
                  [id]="id"
                  [redirectDestination]="[showSidebar ? '.' : '' + '/labbooks', id]"
                  [newModalComponent]="newModalComponent"
                  [initialState]="initialState"
                  [duplicateElement]="false"
                  [privileges]="privileges"
                  *ngIf="privileges"
          ></mlzeln-details-dropdown>
        </div>

        <mlzeln-overview-collapse-element
                id="labbook-collapse-elem"
                class="mb-4" [collapsed]="isCollapsed"
                style="margin-bottom: 2px !important; background-color: rgba(0, 49, 97, 0.04); border-radius: 10px;">
          <form [formGroup]="form" (ngSubmit)="onSubmit()" class="labbook"
                errorTailor>
            <div>
              <mlzeln-details-collapse-element
                [labelText]="t('labBook.details.element.details')">
                <ng-container slot="body">
                  <div class="mb-4">
                    <mlzeln-form-input
                      [id]="title_id"
                      for="title"
                      [label]="t('labBook.details.title.label')"
                      [loading]="loading"
                      [onSubmit]="refreshResetValue"
                      [required]="true"
                    >
                      <input
                        type="text"
                        class="form-control mlzeln-input"
                        id="title"
                        formControlName="labbook_title"
                        name="title"
                        [placeholder]="t('labBook.details.title.placeholder')"
                        slot="input"
                      />
                    </mlzeln-form-input>
                  </div>
                  <div class="mb-4">
                    <mlzeln-form-input for="strict_mode" [loading]="loading"
                                           [onSubmit]="refreshResetValue">
                      <div class="custom-control custom-checkbox" slot="input">
                        <input
                          class="custom-control-input"
                          type="checkbox"
                          formControlName="strict_mode"
                          id="strict_mode"
                          name="strict_mode"
                        />
                        <label class="custom-control-label"
                               for="strict_mode">{{ t('labBook.details.strictMode.label') }}</label>
                      </div>
                    </mlzeln-form-input>
                  </div>
                  <div class="mb-4">
                    <label
                      for="created-by">{{ t('labBook.details.createdBy.label') }}</label>
                    <div class="flex items-center space-x-1">
                      <mlzeln-user-details
                        id="created-by"
                        class="inline-block"
                        [user]="initialState?.created_by"
                      ></mlzeln-user-details>
                      <span> | </span>
                      <span
                        id="created-at">{{ initialState?.created_at | formatDate }}</span>
                    </div>
                  </div>
                  <div class="mb-4">
                    <label
                      for="last-modified-by">{{ t('labBook.details.lastModifiedBy.label') }}</label>
                    <div class="flex items-center space-x-1">
                      <mlzeln-user-details id="last-modified-by"
                                               class="inline-block"
                                               [user]="initialState?.last_modified_by">
                      </mlzeln-user-details>
                      <span> | </span>
                      <span
                        id="last-modified-at">{{ initialState?.last_modified_at | formatDate }}</span>
                    </div>
                  </div>
                </ng-container>
              </mlzeln-details-collapse-element>
            </div>
            <div>
              <mlzeln-details-collapse-element
                [labelText]="t('labBook.details.element.description')">
                <ng-container slot="actions">
                  <button
                    *ngIf="!form.disabled"
                    type="button"
                    class="btn mlzeln-button-regular mlzeln-button-outline"
                    (click)="onOpenDescriptionModal()"
                    [disabled]="loading"
                  >
                    {{ t(descriptionTranslationKey) }}
                  </button>
                </ng-container>
                <ng-container slot="body">
                  <div class="mb-4">
                    <div [id]="preloaded_id"
                         class="description-container"
                         *ngIf="initialState?.description; else noDescription"
                         [innerHTML]="initialState?.description"
                    ></div>
                    <ng-template #noDescription>
                      <span
                        [ngClass]="!privileges?.edit ? 'italic text-tum-disabled' : ''">
                        {{ t('labBook.details.description.noDescription') }}
                      </span>
                    </ng-template>
                  </div>
                </ng-container>
              </mlzeln-details-collapse-element>


            </div>
            <div>
              <mlzeln-details-collapse-element
                [labelText]="t('labBook.details.element.recentChanges')">
                <ng-container slot="body">
                  @defer(on viewport) {
                  <mlzeln-recent-changes
                    id="recent-changes"
                    [service]="labBooksService"
                    [changesId]="id"
                    [refresh]="refreshChanges"
                  ></mlzeln-recent-changes>
                  }
                  @placeholder {
                  <p></p>
                  }
                </ng-container>
              </mlzeln-details-collapse-element>

              <mlzeln-details-collapse-element
                [labelText]="t('labBook.details.element.versions')">
                <ng-container slot="body">
                  @defer(on viewport) {
                  <mlzeln-versions
                    id="versions"
                    contentType="labBook"
                    [service]="labBooksService"
                    [versionId]="id"
                    [lastModifiedAt]="initialState?.last_modified_at"
                    [refresh]="refreshVersions"
                    [editable]="privileges?.restore"
                    [finalizeVersionAlwaysVisible]="true"
                    (changed)="onVersionChanged()"
                  ></mlzeln-versions>
                  }
                  @placeholder {
                  <p></p>
                  }
                </ng-container>
              </mlzeln-details-collapse-element>

            </div>
          </form>
        </mlzeln-overview-collapse-element>
        <!--        we allow all users with view privilege to shift around / resize  elements within draw-board --->
        <mlzeln-labbook-draw-board
          #drawBoard
          [id]="id"
          [editable]="privileges?.view"
        >
        </mlzeln-labbook-draw-board>
      </main>
    </div>
  </ng-container>
</ng-container>
