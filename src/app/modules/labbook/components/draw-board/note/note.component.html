<ng-container *ngIf="initialState">
  <ng-container *transloco="let t">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="element"
          errorTailor>
      <div
        class="header flex justify-between header-container"
        [id]="title_id"
        #title
      >
            <div class="flex-fill">
              <mlzeln-form-input [for]="'subject-' + uniqueHash"
                                     [loading]="loading" [margin]="false">
                <input [style]=this.background_color
                       type="text"
                       class="form-control mlzeln-input"
                       [id]="'subject-' + uniqueHash"
                       formControlName="note_subject"
                       name="subject"
                       [placeholder]="t('labBook.drawBoardNote.details.subject.placeholder')"
                       slot="input"
                       [readOnly]="!editable"
                />
              </mlzeln-form-input>
            </div>
            <div class="ml-2 self-center">
              <span class="mlzeln-button-big mlzeln-button-background"
                    [id]="span_id"
                    #span
                    style="visibility: hidden; text-align: center">Conflict</span>
              <button type="button"
                      class="btn mlzeln-button-big mlzeln-button-background"
                      (click)="create_new_note_below()"
                      *ngIf="editable">
                NoteBelow
              </button>
              <button type="button"
                      class="btn mlzeln-button-big mlzeln-button-background"
                      (click)="create_new_note_aside()"
                      *ngIf="editable">
                NoteAside
              </button>
              <button type="button"
                      class="btn mlzeln-button-big mlzeln-button-background"
                      (click)="onOpenCommentsModal()"
                      *ngIf="editable">
                <joeseln-icon className="wb-comment"
                              class="mr-1"></joeseln-icon>
                <ng-container *ngIf="!element.num_related_comments">
                  {{ t('labBook.drawBoard.element.footer.createComment') }}
                </ng-container>
                <ng-container
                  *ngIf="element.num_related_comments && element.num_related_comments === 1">
                  {{ t('labBook.drawBoard.element.footer.comment', {count: element.num_related_comments}) }}
                </ng-container>
                <ng-container
                  *ngIf="element.num_related_comments && element.num_related_comments > 1">
                  {{ t('labBook.drawBoard.element.footer.comments', {count: element.num_related_comments}) }}
                </ng-container>
              </button>
              <button type="button" class="btn mlzeln-button-big"
                      (click)="toggle_editor()"
                      *ngIf="editable"
                      [disabled]="privileges ? !privileges!.edit : true">
                {{ !editor_loaded ? 'Open Editor' : 'Close Editor' }}
              </button>
              <button type="button"

                      class="btn mlzeln-button-big square-md mlzeln-button-none cursor-move drag-handle mr-2"
                      *ngIf="editable">
                <joeseln-icon className="wb-arrow-cross"></joeseln-icon>
              </button>
            </div>
            <mlzeln-labbook-element-dropdown
              *ngIf="editable"
              [service]="notesService"
              [id]="initialState.pk"
              [labBookId]="id"
              [elementId]="element.pk"
              [initialState]="initialState"
              routerBaseLink="/notes"
              [privileges]="privileges"
              [labBookEditable]="editable"
            ></mlzeln-labbook-element-dropdown>
          </div>
      <div class="body" [id]="'content-' + uniqueHash" #content>
        <ng-container *ngIf="editor_loaded">
          <mlzeln-form-input
            [for]="'content-' + uniqueHash"
            [loading]="loading"
            [margin]="false"
            [buttonPosition]="'align-self-top'"
          >
            <mlzeln-wysiwyg-editor
              [id]="'content-' + uniqueHash"
              [maxHeight]="undefined"
              [inline]=false
              [actual_height]=height
              formControlName="note_content"
              slot="input"
            ></mlzeln-wysiwyg-editor>
          </mlzeln-form-input>
        </ng-container>
        <ng-container>
          <div
            class="note-container"
            [id]="preloaded_id"
            #preload
            [hidden]="editor_loaded"
          ></div>
        </ng-container>
      </div>
    </form>
  </ng-container>
</ng-container>
