<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *ngIf="initialState">
  <ng-container *transloco="let t">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="element"
          errorTailor>
      <div class="header" [id]="title_id">
        <div class="flex justify-between">
          <div class="header_container">
            <div class="flex-fill">
              <eworkbench-form-input [for]="'title-' + uniqueHash"
                                     [loading]="loading" [margin]="false"
                                     [onSubmit]="refreshResetValue">
                <input [style]=this.background_color
                       type="text"
                       class="form-control ewb-input"
                       [id]="'title-' + uniqueHash"
                       formControlName="file_title"
                       name="title"
                       [placeholder]="t('labBook.drawBoardFile.details.title.placeholder')"
                       slot="input"
                />
              </eworkbench-form-input>
            </div>
            <div class="ml-2 self-center">

              <button type="button"
                      class="btn ewb-button-big ewb-button-background"
                      (click)="create_new_note_below()">
                NoteBelow
              </button>
              <button type="button"
                      class="btn ewb-button-big ewb-button-background"
                      (click)="onOpenCommentsModal()">
                <joeseln-icon className="wb-comment"
                              class="mr-1"></joeseln-icon>
                <ng-container *ngIf="!element.num_related_comments">
                  {{ t('labBook.drawBoard.element.footer.createComment') }}
                </ng-container>
                <ng-container
                  *ngIf="element.num_related_comments && element.num_related_comments === 1">
                  {{ t('labBook.drawBoard.element.footer.comment', {count: element.num_related_comments}) }}
                </ng-container>
                <ng-container
                  *ngIf="element.num_related_comments && element.num_related_comments > 1">
                  {{ t('labBook.drawBoard.element.footer.comments', {count: element.num_related_comments}) }}
                </ng-container>
              </button>
              <button type="button" class="btn ewb-button-big"
                      (click)="load_editor()"
                      *ngIf="editable">
                Load Editor
              </button>
              <button type="button"
                      class="btn ewb-button-big square-md ewb-button-none cursor-move drag-handle mr-2"
                      *ngIf="editable">
                <joeseln-icon className="wb-arrow-cross"></joeseln-icon>
              </button>
              <eworkbench-labbook-element-dropdown
                [service]="filesService"
                [id]="initialState.pk"
                [labBookId]="id"
                [elementId]="element.pk"
                [section]="section"
                [initialState]="initialState"
                routerBaseLink="/files"
                [privileges]="privileges"
                [labBookEditable]="editable"
                (removed)="onRemove($event)"
                (moved)="onMove($event)"
              ></eworkbench-labbook-element-dropdown>
            </div>
          </div>
        </div>
      </div>
      <div class="body">
        <!--        <eworkbench-lock [id]="element.child_object_id" [lock]="lock" [lockUser]="lockUser"-->
        <!--                         [service]="filesService"></eworkbench-lock>-->
        <div class="mb-3">
          <alert type="info">
            <div class="text-center">
              <button
                type="button"
                class="btn btn-lg bg-transparent"
                [authDownload]="{ url: initialState.download!, fileName: initialState.original_filename! }"
              >
                <joeseln-icon className="wb-download"
                              class="mr-1"></joeseln-icon>
                {{ initialState.name }}
                ({{ initialState.file_size | formatFileSize }})
              </button>
            </div>
          </alert>
        </div>
        <ng-container *ngIf="editor_loaded">
          <eworkbench-form-input [for]="'description-' + uniqueHash"
                                 [loading]="loading" [margin]="false"
                                 [onSubmit]="refreshResetValue">
            <!--          <eworkbench-wysiwyg-editor-->
            <!--            [id]="'description-' + uniqueHash"-->
            <!--            formControlName="file_description"-->
            <!--            [inline] = true-->
            <!--            slot="input"-->
            <!--          ></eworkbench-wysiwyg-editor>-->
            <eworkbench-wysiwyg-editor
              [id]="'description-' + uniqueHash"
              [maxHeight]="undefined"
              [inline]=false
              formControlName="file_description"
              slot="input"
            ></eworkbench-wysiwyg-editor>
            <!--            <eworkbench-wysiwyg-editor *ngIf="toolbar_shown===false"-->
            <!--                                       [id]="'content-' + uniqueHash"-->
            <!--                                       [inline]=false-->
            <!--                                       formControlName="file_description"-->
            <!--                                       slot="input"-->
            <!--            ></eworkbench-wysiwyg-editor>-->
          </eworkbench-form-input>
        </ng-container>
        <ng-container *ngIf="editor_loaded===false">
          <div [id]="preloaded_id">
          </div>
        </ng-container>
      </div>
<!--      <div class="footer">-->
<!--        <div>-->
<!--          {{ t('labBook.drawBoard.element.footer.lastModifiedBy') }}-->
<!--          <eworkbench-user-details-->
<!--            [user]="element.child_object.last_modified_by"-->
<!--            class="last-modified-by"></eworkbench-user-details>-->
<!--          {{ t('labBook.drawBoard.element.footer.lastModifiedAt.at') }}-->
<!--          {{ element.child_object.last_modified_at | formatDate}}-->
<!--        </div>-->
<!--        <div class="actions">-->
<!--          &lt;!&ndash;          <a [routerLink]="['/files', element.child_object_id]" target="_blank">&ndash;&gt;-->
<!--          &lt;!&ndash;            <button type="button" class="btn ewb-button-big ewb-button-background mr-2">&ndash;&gt;-->
<!--          &lt;!&ndash;              <joeseln-icon className="wb-link" class="mr-1"></joeseln-icon>&ndash;&gt;-->
<!--          &lt;!&ndash;              <ng-container *ngIf="!element.num_relations">&ndash;&gt;-->
<!--          &lt;!&ndash;                {{ t('labBook.drawBoard.element.footer.linkWith') }}&ndash;&gt;-->
<!--          &lt;!&ndash;              </ng-container>&ndash;&gt;-->
<!--          &lt;!&ndash;              <ng-container *ngIf="element.num_relations && element.num_relations === 1">&ndash;&gt;-->
<!--          &lt;!&ndash;                {{ t('labBook.drawBoard.element.footer.link', { count: element.num_relations }) }}&ndash;&gt;-->
<!--          &lt;!&ndash;              </ng-container>&ndash;&gt;-->
<!--          &lt;!&ndash;              <ng-container *ngIf="element.num_relations && element.num_relations > 1">&ndash;&gt;-->
<!--          &lt;!&ndash;                {{ t('labBook.drawBoard.element.footer.links', { count: element.num_relations }) }}&ndash;&gt;-->
<!--          &lt;!&ndash;              </ng-container>&ndash;&gt;-->
<!--          &lt;!&ndash;            </button>&ndash;&gt;-->
<!--          &lt;!&ndash;          </a>&ndash;&gt;-->
<!--          <button type="button" class="btn ewb-button-big ewb-button-background"-->
<!--                  (click)="create_new_note_below()">-->
<!--            NoteBelow-->
<!--          </button>-->
<!--          <button type="button" class="btn ewb-button-big ewb-button-background"-->
<!--                  (click)="onOpenCommentsModal()">-->
<!--            <joeseln-icon className="wb-comment" class="mr-1"></joeseln-icon>-->
<!--            <ng-container *ngIf="!element.num_related_comments">-->
<!--              {{ t('labBook.drawBoard.element.footer.createComment') }}-->
<!--            </ng-container>-->
<!--            <ng-container-->
<!--              *ngIf="element.num_related_comments && element.num_related_comments === 1">-->
<!--              {{ t('labBook.drawBoard.element.footer.comment', {count: element.num_related_comments}) }}-->
<!--            </ng-container>-->
<!--            <ng-container-->
<!--              *ngIf="element.num_related_comments && element.num_related_comments > 1">-->
<!--              {{ t('labBook.drawBoard.element.footer.comments', {count: element.num_related_comments}) }}-->
<!--            </ng-container>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
    </form>
  </ng-container>
</ng-container>
